name: PythonComponentLinux
description: Installs Python and pip on Linux
schemaVersion: 1.0

parameters:
  - name: AdditionalPackages
    type: string
    description: Additional Python packages to install (space-separated)
    default: "boto3 awscli"

phases:
  - name: build
    steps:
      - name: InstallPython
        action: ExecuteBash
        inputs:
          commands:
            - |
              # Detect the base OS for package manager selection
              if [ -f /etc/os-release ]; then
                . /etc/os-release
                OS_ID=$ID
                OS_VERSION=$VERSION_ID
              else
                echo "Cannot detect OS type. Exiting."
                exit 1
              fi

              # Install Python based on OS type
              if [ "$OS_ID" = "amzn" ]; then
                echo "Detected Amazon Linux $OS_VERSION"
                sudo dnf update -y
                sudo dnf install -y python3 python3-pip
              elif [ "$OS_ID" = "ubuntu" ]; then
                echo "Detected Ubuntu $OS_VERSION"
                sudo apt update -y
                sudo apt install -y python3 python3-pip
              else
                echo "Unsupported OS: $OS_ID"
                exit 1
              fi

              # Verify installation
              python3 --version
              pip3 --version
              # Upgrade pip to latest version
              pip3 install --upgrade pip
              # Install additional Python packages from parameter
              if [ -n "{{.AdditionalPackages}}" ]; then
                pip3 install {{.AdditionalPackages}}
              fi
