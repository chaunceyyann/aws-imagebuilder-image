name: AwsCliComponentLinux
description: Installs AWS CLI on Linux
schemaVersion: 1.0

parameters:
  - name: AwsCliVersion
    type: string
    description: Version of AWS CLI to install (e.g., latest or a specific version)
    default: "latest"

phases:
  - name: build
    steps:
      - name: InstallAwsCli
        action: ExecuteBash
        inputs:
          commands:
            - |
              # Detect the base OS
              if [ -f /etc/os-release ]; then
                . /etc/os-release
                OS_ID=$ID
                OS_VERSION=$VERSION_ID
              else
                echo "Cannot detect OS type. Exiting."
                exit 1
              fi

              # Install AWS CLI based on OS type
              if [ "$OS_ID" = "amzn" ]; then
                echo "Detected Amazon Linux $OS_VERSION"
                sudo dnf update -y
                sudo dnf install -y unzip
                # Download and install AWS CLI
                curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
                unzip awscliv2.zip
                sudo ./aws/install
                rm -rf awscliv2.zip aws
              elif [ "$OS_ID" = "ubuntu" ]; then
                echo "Detected Ubuntu $OS_VERSION"
                sudo apt update -y
                sudo apt install -y unzip
                # Download and install AWS CLI
                curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
                unzip awscliv2.zip
                sudo ./aws/install
                rm -rf awscliv2.zip aws
              else
                echo "Unsupported OS: $OS_ID"
                exit 1
              fi

              # Verify installation
              aws --version
