name: PythonComponentWindows
description: Installs Python and pip on Windows Server 2022
schemaVersion: 1.0

parameters:
  - name: PythonVersionUrl
    type: string
    description: URL for the Python installer for Windows
    default: "https://www.python.org/ftp/python/3.11.4/python-3.11.4-amd64.exe"
  - name: AdditionalPackages
    type: string
    description: Additional Python packages to install (space-separated)
    default: "boto3 awscli"

phases:
  - name: build
    steps:
      - name: InstallPython
        action: ExecutePowerShell
        inputs:
          commands:
            - |
              # Check if running on Windows Server 2022
              $osVersion = (Get-WmiObject -class Win32_OperatingSystem).Caption
              if ($osVersion -like "*Windows Server 2022*") {
                Write-Host "Detected Windows Server 2022"
              } else {
                Write-Host "Unsupported OS: $osVersion"
                exit 1
              }

              # Download and install Python for Windows
              $pythonUrl = "{{.PythonVersionUrl}}"
              $installerPath = "C:\Temp\python-installer.exe"
              New-Item -ItemType Directory -Force -Path "C:\Temp"
              Invoke-WebRequest -Uri $pythonUrl -OutFile $installerPath

              # Install Python silently
              Start-Process -FilePath $installerPath -ArgumentList "/quiet InstallAllUsers=1 PrependPath=1" -Wait

              # Verify installation
              $pythonPath = "C:\Program Files\Python311\python.exe"
              & $pythonPath --version

              # Install pip packages
              $pipPath = "C:\Program Files\Python311\Scripts\pip.exe"
              & $pipPath install --upgrade pip
              if ("{{.AdditionalPackages}}" -ne "") {
                & $pipPath install {{.AdditionalPackages}}
              }

              # Clean up
              Remove-Item -Path $installerPath -Force
              Write-Host "Python installed successfully"
