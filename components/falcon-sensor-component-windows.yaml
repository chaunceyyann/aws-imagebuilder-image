name: FalconSensorComponentWindows
description: Installs CrowdStrike Falcon Sensor on Windows Server 2022
schemaVersion: 1.0

parameters:
  - name: FalconWindowsInstallerUrl
    type: string
    description: URL for the Falcon Sensor installer for Windows
    default: "YOUR_FALCON_SENSOR_WINDOWS_INSTALLER_URL"
  - name: CustomerId
    type: string
    description: Customer ID for Falcon Sensor registration
    default: "YOUR_CUSTOMER_ID"

phases:
  - name: build
    steps:
      - name: InstallFalconSensor
        action: ExecutePowerShell
        inputs:
          commands:
            - |
              # Check if running on Windows Server 2022
              $osVersion = (Get-WmiObject -class Win32_OperatingSystem).Caption
              if ($osVersion -like "*Windows Server 2022*") {
                Write-Host "Detected Windows Server 2022"
              } else {
                Write-Host "Unsupported OS: $osVersion"
                exit 1
              }
              
              # Download and install Falcon Sensor for Windows
              $installerUrl = "{{.FalconWindowsInstallerUrl}}"
              $installerPath = "C:\Temp\falcon-sensor.exe"
              New-Item -ItemType Directory -Force -Path "C:\Temp"
              Invoke-WebRequest -Uri $installerUrl -OutFile $installerPath
              
              # Install Falcon Sensor - adjust parameters as needed
              Start-Process -FilePath $installerPath -ArgumentList "/install /quiet /norestart CID={{.CustomerId}}" -Wait
              
              # Clean up
              Remove-Item -Path $installerPath -Force
              Write-Host "Falcon Sensor installed successfully" 